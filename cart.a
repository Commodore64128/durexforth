!cpu 6510
!ct raw
!to "build/cart.bin", plain	; set output file and format
	
* = $8000
     !word coldstart            ; coldstart vector
     !word warmstart            ; warmstart vector
     !byte $C3,$C2,$CD,$38,$30  ; "CBM80". Autostart string
 
coldstart
     sei
     stx $d016
     jsr $fda3 ;Prepare IRQ
     jsr $fd50 ;Init memory. Rewrite this routine to speed up boot process.
     jsr $fd15 ;Init I/O
     jsr $ff5b ;Init video
     cli
 
warmstart
    lda #<durexforth_bin
    sta $8b
    lda #>durexforth_bin
    sta $8c
    lda #8
    sta $8e
    lda #$d
    sta $8d
    ldy #0
.startcpy
    lda ($8b),y
    sta ($8d),y
    inc $8b
    bne x
    inc $8c
    lda $8c
    cmp #$c0
    beq done
x
    inc $8d
    bne .startcpy
    inc $8e
    jmp .startcpy

done
    ldx #0
    jmp $80d

durexforth_bin
    !binary "build/durexforth",,$e
 
* = $bfff                     ; fill up to -$9fff (or $bfff if 16K)
     !byte 0
